{% extends 'mainapp/base.html' %}
{% load static %}
{% load main_extras %}

{% block content %}
<div class="account container content_wrapper">
    <div class="row pt-4">
        <div class="col-xl-8 col-xxl-9">
            <div class="row g-0 bg-primary overflow-hidden flex-md-row h-md-250 position-relative shadow">
                <div class="tab-content col p-3 text-white">
                    <h1 id="h-pills-posts" class="tab-pane fade show active fw-bold">
                        <i class="fa-solid fa-magnifying-glass fa-xl me-3"></i>
                        Результаты поиска
                    </h1>
                </div>
            </div>
            <div class="row g-0 bg-white overflow-hidden flex-md-row mb-1 h-md-250 position-relative shadow overflow-visible">
                {% include 'mainapp/includes/inc_search_filters.html' %}
            </div>
        </div>
    </div>

    <div id="pills-posts" class="tab-pane fade show active">
    {% for post in posts_list %}
        <div class="row g-0 bg-white overflow-hidden flex-md-row mb-3 h-md-250 position-relative shadow">
            <div class="col p-3 pb-2 d-flex flex-column position-static">
                <div class="d-flex mb-2 text-small align-items-center">
                    <img
                        class="rounded-circle shadow-1-strong me-3"
                        src="{% get_avatar post.author %}" alt="avatar" width="32"
                        height="32">
                        <a href="#" class="nav-link p-0 fw-bold me-2">
                            {{ post.author.first_name|capfirst }} {{ post.author.last_name|capfirst }}
                        </a>
                    <span class="date_info text-secondary me-5">{{ post.created }}</span>
{#                    <span class="py-0 px-2 text-primary fw-bold me-2 border bg-light">{{ post.status|filter_post_status }}</span>#}
                </div>

                <h3 class="mb-1">
                    <a href="{% url 'post_page' post.pk %}" class="nav-link p-0 text-secondary">
                        {{ post.topic|capfirst }}
                    </a>
                </h3>

                <p class="mb-4">
                    {{ post.annotation|safe }}
                </p>

                <div class="mb-2">
                    {% if user == target_user %}
                    <div class="dropdown dropstart mb-2">
                        <a
                            class="btn btn-outline-primary opacity-75 btn-sm px-3 "
                            href="#" role="button" id="post_dropdown"
                            data-bs-toggle="dropdown" aria-expanded="false"
                        >
                            Детали
                        </a>


                    </div>
                    {% else %}
                    <a
                        class="btn btn-outline-primary btn-sm me-3"
                        type="button"
                        href="{% url 'post_page' post.pk %}"
                    >
                        Перейти
                    </a>
                    {% endif %}
                </div>

                <div class="d-flex flex-grow-1 align-items-end text-small">
                    <span class="me-3 text-muted"><i class="me-1 fa-solid text-primary opacity-75 fa-eye {% check_view post user %}"></i> {{ post.total_views }}</span>
                    <span class="me-3 text-muted"><i class="me-1 fa-regular text-primary opacity-75 fa-comment {% check_comment post user %}"></i> {{ post.total_comments }}</span>
                    <span class="me-3 text-muted"><i class="me-1 fa-regular text-primary opacity-75 fa-thumbs-up {% check_like post user %}"></i> {{ post.total_likes }} </span>
                    <span class="me-3 text-muted"><i class="me-1 fa-regular text-primary opacity-75 fa-bookmark {% check_bookmark post user %}"></i> {{ post.total_bookmarks }}</span>
                </div>
                </div>
                <div class="col-auto d-none d-lg-block p-3">
                    <img
                        src="{{ post.image.url }}"
                        class="img-fluid"
                        alt="post image"
                        height="270"
                    >
                </div>
            </div>
    {% empty %}
            <div class="row g-0 bg-white overflow-hidden flex-md-row mb-4 h-md-250 position-relative shadow">
                <div class="col p-3 d-flex flex-column position-static">
                    <div class="d-flex mb-2">
					<p>Не найдено публикаций по вашему запросу.<br>Попробуйте повторить запрос с другой формулировкой.</p>
					</div>
				</div>
			</div>
    {% endfor %}

    </div>
    {% include 'mainapp/includes/inc_sidebar.html' %}
</div>

{% endblock %}

{% block script %}
<script src="{% static 'js/search.js' %}"></script>
{% endblock %}
